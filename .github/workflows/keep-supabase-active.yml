name: Keep Supabase Active

on:
  schedule:
    # 3ì¼ë§ˆë‹¤ ì‹¤í–‰ (0ì‹œ 0ë¶„)
    - cron: '0 0 */7 * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  keep-active:
    runs-on: ubuntu-latest
    
    steps:
    - name: Keep Supabase Database Active
      run: |
        echo "ğŸ”„ Supabase í™œì„±í™” ìš”ì²­ ì „ì†¡ ì¤‘..."
        echo "URL: ${{ secrets.DEPLOYED_URL }}/api/keep-alive"
        echo "ì‹œê°„: $(date)"
        
        # ë°°í¬ëœ ì‚¬ì´íŠ¸ì˜ API ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
        RESPONSE=$(curl -X POST "${{ secrets.DEPLOYED_URL }}/api/keep-alive" \
          -H "Content-Type: application/json" \
          -H "X-Keep-Alive-Secret: ${{ secrets.KEEP_ALIVE_SECRET }}" \
          --write-out "HTTPSTATUS:%{http_code}" \
          --silent --show-error)
        
        # HTTP ìƒíƒœ ì½”ë“œ ì¶”ì¶œ
        HTTP_CODE=$(echo $RESPONSE | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
        BODY=$(echo $RESPONSE | sed -e 's/HTTPSTATUS\:.*//g')
        
        echo "HTTP ìƒíƒœ ì½”ë“œ: $HTTP_CODE"
        echo "ì‘ë‹µ ë‚´ìš©: $BODY"
        
        if [ $HTTP_CODE -eq 200 ]; then
          echo "âœ… Supabase í™œì„±í™” ì„±ê³µ!"
        else
          echo "âŒ Supabase í™œì„±í™” ì‹¤íŒ¨ (ì½”ë“œ: $HTTP_CODE)"
          exit 1
        fi
